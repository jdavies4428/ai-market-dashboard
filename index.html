<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Market Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: #fff; color: #333; font-size: 13px; line-height: 1.4; }
        .header { background: #1a1a2e; color: white; padding: 15px 20px; border-bottom: 3px solid #00d084; }
        .header h1 { font-size: 20px; font-weight: 600; margin-bottom: 5px; }
        .header .subtitle { font-size: 12px; color: #888; }
        .indices-bar { background: #f8f9fa; padding: 10px 20px; border-bottom: 1px solid #e0e0e0; display: flex; gap: 30px; flex-wrap: wrap; }
        .index-item { display: flex; align-items: center; gap: 8px; }
        .index-name { font-weight: 600; color: #666; }
        .index-value { font-family: 'SF Mono', Monaco, monospace; font-weight: 600; }
        .index-change { font-family: 'SF Mono', Monaco, monospace; font-size: 12px; }
        .positive { color: #137333; }
        .negative { color: #d93025; }
        .sma-cell { text-align: center !important; vertical-align: middle; }
        .sma-cell .arrow { display: inline-block; font-size: 14px; line-height: 1; }
        .price-cell { text-align: right; padding-right: 15px; }
        .sector { margin-bottom: 0; }
        .sector-header { background: #f1f3f4; padding: 8px 20px; font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #666; border-bottom: 1px solid #e0e0e0; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: #fafafa; padding: 10px 8px; text-align: right; font-weight: 600; color: #666; border-bottom: 2px solid #e0e0e0; font-size: 11px; white-space: nowrap; }
        th:first-child { text-align: left; padding-left: 20px; }
        td { padding: 8px; text-align: right; border-bottom: 1px solid #f0f0f0; font-family: 'SF Mono', Monaco, monospace; }
        td:first-child { text-align: left; padding-left: 20px; font-family: inherit; font-weight: 600; }
        tr:hover { background: #f8f9fa; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: rgba(255, 71, 87, 0.1); border: 1px solid #ff4757; color: #ff4757; padding: 20px; border-radius: 8px; margin: 20px; }
        .refresh-btn { position: fixed; bottom: 10px; left: 10px; background: #1a1a2e; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .timestamp { position: fixed; bottom: 10px; right: 10px; font-size: 11px; color: #999; background: white; padding: 5px 10px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="header">
        <div class="subtitle">ðŸ¤– AI Market Dashboard</div>
        <h1>Market Dashboard</h1>
    </div>
    
    <div class="indices-bar" id="indices"><div class="loading">Loading...</div></div>
    <div class="container" id="sectors"><div class="loading" style="padding: 20px;">Loading watchlist...</div></div>
    
    <div class="timestamp" id="timestamp"></div>
    <button class="refresh-btn" onclick="loadData()">ðŸ”„ Refresh</button>
    
    <script>
        // CORS proxy for Yahoo Finance
        const CORS_PROXY = 'https://api.allorigins.win/get?url=';
        const YAHOO_API = 'https://query1.finance.yahoo.com/v8/finance/chart/';
        
        const WATCHLIST = ['AMZN','GOOGL','META','MSFT','ORCL','AMD','ARM','AVGO','INTC','MRVL','NVDA','MU','SNDK','STX','WDC','ALAB','CRDO','AAOI','CIEN','COHR','GLW','LITE','LUMN','APLD','CIFR','CRWV','IREN','NBIS','DELL','SMCI','BE','CEG','IESC','OKLO','PSIX','SMR','VRT','VST'];
        
        const INDICES = {'^GSPC':'S&P 500','^DJI':'Dow Jones','^IXIC':'Nasdaq','BTC-USD':'Bitcoin'};
        
        const SECTORS = {
            'HYPERSCALERS': ['AMZN','GOOGL','META','MSFT','ORCL'],
            'CHIPS': ['AMD','ARM','AVGO','INTC','MRVL','NVDA'],
            'MEMORY': ['MU','SNDK','STX','WDC'],
            'NETWORKING': ['ALAB','CRDO'],
            'OPTICAL': ['AAOI','CIEN','COHR','GLW','LITE','LUMN'],
            'NEOCLOUDS': ['APLD','CIFR','CRWV','IREN','NBIS'],
            'SERVERS': ['DELL','SMCI'],
            'POWER': ['BE','CEG','IESC','OKLO','PSIX','SMR','VRT','VST']
        };

        async function fetchYahoo(symbol) {
            try {
                const url = `${YAHOO_API}${symbol}?interval=1d&range=1y`;
                const res = await fetch(`${CORS_PROXY}${encodeURIComponent(url)}`);
                const data = await res.json();
                return data.contents ? JSON.parse(data.contents) : null;
            } catch(e) { console.error(symbol, e); return null; }
        }

        function fmt(n,d=2) { return n===null?'-':n.toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d}); }
        function cls(c) { return c>=0?'positive':'negative'; }
        
        function calcSMA(prices) {
            const s={}; [5,10,20,50,100,200].forEach(p=>{s[`SMA${p}`]=prices.length>=p?prices.slice(-p).reduce((a,b)=>a+b,0)/p:null;});
            return s;
        }

        async function loadData() {
            document.getElementById('sectors').innerHTML='<div class="loading">Loading...</div>';
            const data={};
            
            // Fetch indices
            for(const[s,n]of Object.entries(INDICES)){
                const d=await fetchYahoo(s);
                if(d?.chart?.result?.[0]){
                    const r=d.chart.result[0], p=r.indicators.quote[0].close.filter(x=>x!==null);
                    if(p.length>0){
                        const latest=p[p.length-1], prev=p[p.length-2]||latest;
                        data[s.replace('^','')]={name:n,price:latest,change:latest-prev,changePct:((latest-prev)/prev)*100,smas:calcSMA(p)};
                    }
                }
            }
            
            // Fetch watchlist
            for(const s of WATCHLIST){
                const d=await fetchYahoo(s);
                if(d?.chart?.result?.[0]){
                    const r=d.chart.result[0], p=r.indicators.quote[0].close.filter(x=>x!==null), t=r.timestamp;
                    if(p.length>0){
                        const latest=p[p.length-1], prev=p[p.length-2]||latest;
                        const ytdIdx=t.findIndex(x=>new Date(x*1000)>=new Date(new Date().getFullYear(),0,1));
                        data[s]={price:latest,change:latest-prev,changePct:((latest-prev)/prev)*100,ret1w:((latest-(p[p.length-6]||p[0]))/(p[p.length-6]||p[0]))*100,ret1m:((latest-(p[p.length-22]||p[0]))/(p[p.length-22]||p[0]))*100,retytd:((latest-(p[ytdIdx>0?ytdIdx:0]||p[0]))/(p[ytdIdx>0?ytdIdx:0]||p[0]))*100,smas:calcSMA(p)};
                    }
                }
            }
            
            document.getElementById('timestamp').textContent='Updated: '+new Date().toLocaleTimeString();
            renderIndices(data); renderSectors(data);
        }

        function renderIndices(data){
            const el=document.getElementById('indices');
            let html='';
            ['GSPC','DJI','IXIC','BTCUSD'].forEach(k=>{
                const i=data[k]; if(i){
                    const n=k==='BTCUSD'?'â‚¿ BTC':k==='GSPC'?'S&P 500':k==='DJI'?'Dow':'Nasdaq';
                    html+=`<div class="index-item"><span class="index-name">${n}:</span><span class="index-value">${fmt(i.price)}</span><span class="index-change ${cls(i.change)}">${i.change>=0?'+':''}${fmt(i.changePct)}%</span></div>`;
                }
            });
            el.innerHTML=html||'<div class="error">No data</div>';
        }

        function renderSectors(data){
            const el=document.getElementById('sectors'), bySector={}, tSect={};
            Object.entries(SECTORS).forEach(([s,t])=>t.forEach(x=>tSect[x]=s));
            
            WATCHLIST.forEach(s=>{const t=data[s];if(t){const sec=tSect[s]||'OTHER';if(!bySector[sec])bySector[sec]=[];bySector[sec].push({s,...t});}});
            Object.values(bySector).forEach(x=>x.sort((a,b)=>b.changePct-a.changePct));
            
            let dist=[]; Object.values(bySector).forEach(t=>t.forEach(x=>[5,10,20,50,100,200].forEach(p=>{if(x.smas[`SMA${p}`]){const d=Math.abs((x.price-x.smas[`SMA${p}`])/x.smas[`SMA${p}`]*100);dist.push(d);}})));
            const maxD=dist.length>0?Math.max(...dist):10;
            
            let html='';
            ['HYPERSCALERS','CHIPS','MEMORY','NETWORKING','OPTICAL','NEOCLOUDS','SERVERS','POWER'].forEach(sec=>{
                if(!bySector[sec])return;
                html+=`<div class="sector"><div class="sector-header">${sec}</div><table><thead><tr><th>Ticker</th><th>Price</th><th>Change</th><th>%Chg</th><th>1W</th><th>1M</th><th>YTD</th><th>5SMA</th><th>10SMA</th><th>20SMA</th><th>50SMA</th><th>100SMA</th><th>200SMA</th></tr></thead><tbody>`;
                bySector[sec].forEach(t=>{
                    let smaCells=''; [5,10,20,50,100,200].forEach(p=>{const v=t.smas[`SMA${p}`];if(!v){smaCells+='<td class="sma-cell">-</td>';}else{const d=(t.price-v)/v*100,op=0.3+(Math.min(Math.abs(d),maxD)/maxD)*0.7;let a,ac;if(Math.abs(d)<0.1){a='âž¡';ac='';}else if(d>0){a='â–²';ac='positive';}else{a='â–¼';ac='negative';}smaCells+=`<td class="sma-cell"><span class="arrow ${ac}" style="opacity:${op}">${a}</span></td>`;}});
                    html+=`<tr><td><strong>${t.s}</strong></td><td class="price-cell">${fmt(t.price)}</td><td class="${cls(t.change)}">${t.change>=0?'+':''}${fmt(t.change)}</td><td class="${cls(t.change)} pct-cell">${t.change>=0?'+':''}${fmt(t.changePct)}%</td><td class="${cls(t.ret1w)}">${t.ret1w>=0?'+':''}${fmt(t.ret1w)}%</td><td class="${cls(t.ret1m)}">${t.ret1m>=0?'+':''}${fmt(t.ret1m)}%</td><td class="${cls(t.retytd)}">${t.retytd>=0?'+':''}${fmt(t.retytd)}%</td>${smaCells}</tr>`;
                });
                html+='</tbody></table></div>';
            });
            el.innerHTML=html;
        }

        loadData();
        setInterval(loadData,60000);
    </script>
</body>
</html>
